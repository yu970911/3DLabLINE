# スプレッドシート設計（v1.0）

このドキュメントは「3DLab ワークショップ運用 自動化LINEシステム」のスプレッドシート構成を具体化した設計メモです。
列名は仕様書の記載を優先し、型・例・バリデーション方針を付記します。

## 共通ルール
- 日時は `yyyy-MM-dd HH:mm:ss` を推奨（例: 2025-01-31 10:30:00）
- 真偽値は `TRUE/FALSE`（Google Sheetsの論理値）
- IDは英数と記号を許容する文字列
- `LINEユーザーID` はMessaging APIのユーザーID（例: Uxxxxxxxx...）

---

## 1) 友だち一覧
目的: LINE友だちの状態・属性管理

| 列名 | 型 | 例 | ルール/メモ |
|---|---|---|---|
| LINEユーザーID | string | U1234... | 主キー。重複不可 |
| 表示名 | string | 3DLab太郎 | LINE表示名 |
| フルネーム | string | 山田 太郎 | 入力完了後に確定 |
| 区分 | string | 参加者 | `参加者/見込み/スタッフ` のみ |
| 状態 | string | 通常 | `種別待ち/名前待ち/WSコード待ち/通常` |
| 最終参加ワークショップID | string | WS-202501 | 未参加なら空欄 |
| 最終アクション日時 | datetime | 2025-01-31 10:30:00 | 受信/送信/更新で更新 |
| 初回参加日 | date | 2025-01-10 | 初回参加時に設定 |
| 参加回数 | number | 2 | 参加者一覧から算出/更新 |
| 興味タグ | string | 親子,3Dペン | カンマ区切り |
| メモ | string | 次回案内希望 | 手入力 |

サンプル行:

```text
U11111111111111111111,3DLab太郎,山田 太郎,参加者,通常,WS-202501,2025-02-10 10:20:00,2025-02-10,1,親子,初回参加
U22222222222222222222,3DLab花子,,見込み,種別待ち,,2025-02-05 09:10:00,,,3Dペン,チラシ経由
U33333333333333333333,3DLabスタッフ,佐藤 担当,スタッフ,通常,,2025-02-01 12:00:00,,,,
```

---

## 2) ワークショップ開催管理
目的: 開催情報と自動配信制御

| 列名 | 型 | 例 | ルール/メモ |
|---|---|---|---|
| ワークショップID | string | WS-202501 | 主キー。重複不可 |
| ワークショップ名 | string | 3Dペン体験会 | - |
| 開催日 | date | 2025-02-10 | - |
| 開始時刻 | time | 10:00 | - |
| 終了時刻 | time | 12:00 | - |
| 当日使用URL | string | https://example.com/join | 当日参加者へ送信 |
| 紹介サイトURL | string | https://example.com/after | 終了後案内 |
| リマインド送信日時 | datetime | 2025-02-10 09:00:00 | 自動配信用 |
| お礼送信日時 | datetime | 2025-02-10 18:00:00 | 自動配信用 |
| クーポン文面 | string | 次回10%OFF | 省略可 |
| 配信対象タグ | string | 親子 | タグ一致配信 |
| 有効 | boolean | TRUE | 運用中のみTRUE |

サンプル行:

```text
WS-202501,3Dペン体験会,2025-02-10,10:00,12:00,https://example.com/join,https://example.com/after,2025-02-10 09:00:00,2025-02-10 18:00:00,次回10%OFF,親子,TRUE
WS-202502,はじめての3Dプリント,2025-03-01,13:30,15:30,https://example.com/join2,https://example.com/after2,2025-03-01 12:30:00,2025-03-01 18:00:00,,3Dプリント,TRUE
```

---

## 3) 参加者一覧（参加履歴）
目的: 参加履歴・リピート判定

| 列名 | 型 | 例 | ルール/メモ |
|---|---|---|---|
| ワークショップID | string | WS-202501 | 開催管理と紐付け |
| LINEユーザーID | string | U1234... | 友だち一覧と紐付け |
| フルネーム | string | 山田 太郎 | 参加時点の氏名 |
| 参加区分 | string | 当日 | `当日/事前` |
| 参加日時 | datetime | 2025-02-10 10:05:00 | 当日参加時に記録 |
| リマインド送信日時 | datetime | 2025-02-10 09:00:00 | 送信時に記録 |
| お礼送信日時 | datetime | 2025-02-10 18:00:00 | 送信時に記録 |
| アンケート回答済 | boolean | FALSE | フォーム回答連携で更新 |
| 備考 | string | 遅刻 | 任意 |

サンプル行:

```text
WS-202501,U11111111111111111111,山田 太郎,当日,2025-02-10 10:05:00,2025-02-10 09:00:00,2025-02-10 18:00:00,FALSE,
WS-202501,U44444444444444444444,田中 次郎,事前,2025-02-10 10:00:00,2025-02-10 09:00:00,2025-02-10 18:00:00,TRUE,アンケート回答済
```

---

## 4) メッセージ管理
目的: メッセージ文言のノーコード管理

| 列名 | 型 | 例 | ルール/メモ |
|---|---|---|---|
| メッセージID | string | MSG-001 | 主キー。重複不可 |
| 用途 | string | 当日参加URL | 目的の短い説明 |
| タイトル | string | 当日のご案内 | - |
| 本文 | string | こんにちは{FULL_NAME}... | 変数差し込み可 |
| クイック返信 | string | 当日参加:当日参加|問い合わせ:問い合わせ | `ラベル:送信テキスト` を `|` 区切り |
| 有効 | boolean | TRUE | - |
| 最終更新日時 | datetime | 2025-01-31 12:00:00 | 更新時に記録 |
| 備考 | string | v1.0 | 任意 |

サンプル行:

```text
MSG-001,当日参加URL,当日のご案内,こんにちは{FULL_NAME}さん。当日はこちらからご参加ください。{JOIN_URL},当日参加:当日参加|問い合わせ:問い合わせ,TRUE,2025-01-31 12:00:00,
MSG-002,お礼+アンケート,ご参加ありがとうございました,本日のご参加ありがとうございました。紹介サイト: {AFTER_URL} アンケート: {SURVEY_URL},アンケート:アンケート,TRUE,2025-01-31 12:00:00,
```

差し込み変数:
- `{FULL_NAME}`
- `{JOIN_URL}`
- `{AFTER_URL}`
- `{SURVEY_URL}`

---

## 5) 送信履歴
目的: 全配信ログ管理

| 列名 | 型 | 例 | ルール/メモ |
|---|---|---|---|
| 送信日時 | datetime | 2025-02-10 09:00:00 | 実送信時刻 |
| 種別 | string | プッシュ | `返信/プッシュ` |
| 宛先LINEユーザーID | string | U1234... | - |
| 宛先区分 | string | 参加者 | `参加者/見込み/スタッフ` |
| 関連ワークショップID | string | WS-202501 | 該当なしは空欄 |
| 使用メッセージID | string | MSG-001 | メッセージ管理と紐付け |
| 送信本文 | string | こんにちは... | 実際に送った本文 |
| 送信結果 | string | 成功 | `成功/失敗` |
| LINEレスポンス | string | 200 OK | 失敗時の情報を記録 |
| 担当 | string | 自動 | `自動/スタッフ` |

サンプル行:

```text
2025-02-10 09:00:00,プッシュ,U11111111111111111111,参加者,WS-202501,MSG-001,こんにちは山田 太郎さん。当日はこちらからご参加ください。https://example.com/join,成功,200 OK,自動
2025-02-10 18:00:00,プッシュ,U11111111111111111111,参加者,WS-202501,MSG-002,本日のご参加ありがとうございました。紹介サイト: https://example.com/after アンケート: https://example.com/survey,成功,200 OK,自動
```

---

## 追加メモ（運用）
- 友だち一覧の `参加回数` は参加者一覧から集計して定期更新
- `状態` をトリガーに会話フローを分岐（例: 名前待ちのときは氏名入力を促す）
- `配信対象タグ` は簡易セグメントの入口。将来はタグマスターを追加予定
