# スタッフ登録フロー設計（v1.0）

前提:
- 合言葉: `3DLabスタッフ`
- 権限: C（全操作）
- 登録後通知: 管理者にLINE通知

---

## 1) フロー概要

1. スタッフ希望者が合言葉を送信
2. 友だち一覧の区分を `スタッフ` に変更
3. スタッフ登録完了メッセージを返信
4. 管理者へ「スタッフ登録通知」をプッシュ

---

## 2) 追加データ/設定

### 2.1 スクリプトプロパティ（追加）
- `STAFF_PASSCODE` : 合言葉（例: 3DLabスタッフ）
- `ADMIN_USER_IDS` : 管理者のLINEユーザーID（カンマ区切りで複数可）

### 2.2 友だち一覧の更新
- `区分` = `スタッフ`
- `状態` = `通常`
- `最終アクション日時` 更新

---

## 3) 受信ルール

### 3.1 通常ユーザー
- 受信テキストが `STAFF_PASSCODE` と一致した場合:
  - スタッフ登録フローへ

### 3.2 既にスタッフ
- 再送信の場合:
  - 「登録済み」メッセージを返信

---

## 4) メッセージ案（メッセージ管理）

### 4.1 スタッフ登録完了
- メッセージID: `MSG-101`
- 本文: `スタッフ登録が完了しました。`
- Quick Reply: `案内:案内|問い合わせ:問い合わせ`

### 4.2 スタッフ登録済み
- メッセージID: `MSG-102`
- 本文: `すでにスタッフ登録済みです。`

### 4.3 管理者通知
- メッセージID: `MSG-103`
- 本文: `スタッフ登録: {FULL_NAME}（{LINE_USER_ID}）`

---

## 5) 実装ポイント（GAS）

- `handleNormalMessage` に合言葉判定を追加
- 判定は `normalizeText(text)` と `STAFF_PASSCODE` を比較
- `ADMIN_USER_IDS` はカンマ区切りで複数送信

---

## 6) 権限（C: 全操作）

- スタッフのみが以下を実行できる設計にする:
  - ワークショップ登録（対話形式）
  - 配信トリガーの手動実行
  - 送信履歴の閲覧用通知

※ Phase2以降で実装
